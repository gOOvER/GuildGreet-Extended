name: Code Quality

on:
  push:
    branches: [ master, main ]
  pull_request:
    branches: [ master, main ]

jobs:
  luacheck:
    name: Lua Code Quality
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Install Lua and luacheck
      run: |
        sudo apt-get update
        sudo apt-get install -y lua5.1 luarocks
        sudo luarocks install luacheck
        
    - name: Run luacheck
      run: |
        echo "Running basic luacheck..."
        if luacheck --no-color --codes --ignore 111 112 113 GuildGreet.lua; then
          echo "✅ No critical issues found"
        else
          echo "⚠️ Issues found but acceptable for WoW addon"
        fi

  toc-validation:
    name: TOC Validation
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Validate TOC
      run: |
        echo "Validating TOC file..."
        if [ -f "GuildGreet.toc" ]; then
          echo "✅ TOC file found"
        else
          echo "❌ TOC file missing"
          exit 1
        fi
